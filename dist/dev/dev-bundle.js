!function(){"use strict";const e=e=>"connection"in navigator?e.indexOf(navigator.connection.effectiveType)>=0?"slow":"fast":"unknown",t=e=>null!==sessionStorage.getItem(e),n=e=>{try{return t(e)?JSON.parse(sessionStorage.getItem(e)):{}}catch(e){return console.log(e),0}},o=(e,t)=>{try{sessionStorage.setItem(t,JSON.stringify(e))}catch(e){console.log(e)}};const a=(e,t)=>{o(e,t),function(e){const t=n(e),o=document.getElementsByTagName("html")[0];Object.entries(t).forEach((e=>{const[t,n]=e,a=`${t}-${n}`;o.classList.add(a)}))}(t)},s=t=>{const{lowRAM:n,lowCPU:o,slowConnectionTypes:a}=t;return{memoryLevel:(e=>{if(!("deviceMemory"in navigator))return"unknown";const t=navigator.deviceMemory;return t===e?"mid":t>e?"high":"low"})(n),cpuLevel:(e=>{if(!("hardwareConcurrency"in navigator))return"unknown";const t=navigator.hardwareConcurrency;return t===e?"mid":t>e?"high":"low"})(o),connectionSpeed:e(a),saveData:"connection"in navigator?navigator.connection.saveData:0,reducedMotion:window.matchMedia("(prefers-reduced-motion: reduce)").matches,doNotTrack:(()=>{const e="doNotTrack"in navigator,t="1"===navigator.doNotTrack;return e&&t})()}},l="settingsModal",c=l,i="settingsModal--open",r="settingsModal--closed",d="settingsModal--banner",u="settingsModal__header",p="settingsModal__title",g="settingsModal__form",v="settingsModal__submit",m="settingsModal__options",$="settingsModal__option",f="settingsModal__controller",h="settingsModal__controller--toggle",y="settingsModal__controller--options",w="settingsModal__controller--view",b="settingsModal__parameter",k="settingsModal__parameterValue",M="settingsModal__parameterInput",S="settingsModal__input",_="settingsModal__label",L="settingsModal__toggle",D="settingsModal__slider",E="settingsModal__icon",T="settingsModal__closeIcon",x="settingsModal__openIcon",I="assets/Symbol_ProgUX.svg",V="ProgUX logo symbol",P="ProgUX logo symbol",U={settingsModalSubmitId:"settingsModalSubmit",settingsModalFormId:"settingsModalForm"},q={title:"memory level",id:"settingsModalMemoryLevel",valuePrefix:"memory-level",options:[{type:"radio",id:"memory-level-low",name:"memoryLevel",value:"low",label:"low"},{type:"radio",id:"memory-level-mid",name:"memoryLevel",value:"mid",label:"mid"},{type:"radio",id:"memory-level-high",name:"memoryLevel",value:"high",label:"high"},{type:"radio",id:"memory-level-unknown",name:"memoryLevel",value:"unknown",label:"unknown"}]},C={title:"CPU level",id:"settingsModalCpuLevel",valuePrefix:"cpu-level",options:[{type:"radio",id:"cpu-level-low",name:"cpuLevel",value:"low",label:"low"},{type:"radio",id:"cpu-level-mid",name:"cpuLevel",value:"mid",label:"mid"},{type:"radio",id:"cpu-level-high",name:"cpuLevel",value:"high",label:"high"},{type:"radio",id:"cpu-level-unknown",name:"cpuLevel",value:"unknown",label:"unknown"}]},O={title:"Connection speed",id:"settingsModalConnectionSpeed",valuePrefix:"connection-speed",options:[{type:"radio",id:"connection-speed-slow",name:"connectionSpeed",value:"slow",label:"slow"},{type:"radio",id:"connection-speed-fast",name:"connectionSpeed",value:"fast",label:"fast"},{type:"radio",id:"connection-speed-unknown",name:"connectionSpeed",value:"unknown",label:"unknown"}]},A={title:"Save data",id:"saveData",name:"saveData",value:"true",checkedValue:"true",uncheckedValue:"false"},N={title:"Reduced motion",id:"reducedMotion",name:"reducedMotion",value:"true",checkedValue:"true",uncheckedValue:"false"},j={title:"Do not track",id:"doNotTrack",name:"doNotTrack",value:"true",checkedValue:"true",uncheckedValue:"false"},B={memoryLevel:q,cpuLevel:C,connectionSpeed:O},K={saveData:A,reducedMotion:N,doNotTrack:j},X={title:"Banner view",id:"view",name:"view",value:"disabled",checkedValue:"enabled",uncheckedValue:"disabled"};function F(e){const t=function(e){let t="";return e.forEach((e=>{t+=`<li class="${$}">\n        <input type="${e.type}" id="${e.id}" class="${S}" name="${e.name}" value="${e.value}">\n        <label for="${e.id}" class="${_}">${e.label}</label>\n    </li>`})),t}(e.options);return`<div class="${f} ${y}">\n    <p class="${b}">${e.title}</p>\n    <p class="${k}"></p>\n    <ul class="${m} ${M}" id="${e.id}">\n        ${t}\n    </ul>\n  </div>`}function z(e){return`<div class="${f} ${h}">\n    <p class="${b}">${e.title}</p>\n    <p class="${k}">${e.value}</p>\n    <label class="${L} ${M}">\n      <input type="checkbox" \n              id="${e.id}" \n              class="${S}"\n              name="${e.name}" \n              value="${e.value}"\n              data-checked-value="${e.checkedValue}"\n              data-unchecked-value="${e.uncheckedValue}">\n      <span class="${D}"></span>\n    </label>\n  </div>`}const J=e=>{const t=function(e){const{mode:t,posTop:n,posLeft:o,isDraggable:a}=e;let s="closed"===t?`${c}--closed`:`${c}--open`;return"banner"===t&&(s+=` ${c}--banner`),`<div class="${c} ${s}"\n               style="top: ${n}px; left: ${o}px;"\n               id="${c}" \n               draggable="${a?"true":"false"}">`}(e),n=`<button type="submit" class="${v}" id="${U.settingsModalSubmitId}" value="Submit">Update</button>`;return`${t}\n    ${`<div class="${u}">\n    <img src="${I}" alt="${V}" title="${P}" width="40" height="40">\n    <p class="${p}">Simulator</p>\n    <span class="${E} ${T}">\n      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 30 30">\n  <path fill-rule="evenodd" d="M30 3.021L26.979 0 15 11.979 3.021 0 0 3.021 11.979 15 0 26.979 3.021 30 15 18.021 26.979 30 30 26.979 18.021 15z"/>\n</svg>\n    </span>\n    <span class="${E} ${x}">\n      <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24">\n  <path d="M0 0h24v24H0V0z" fill="none"/>\n  <path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/>\n</svg>\n    </span>\n  </div>`}\n    ${`<form class="${g}" id="${U.settingsModalFormId}">`}\n    ${F(q)}\n    ${F(C)}\n    ${F(O)}\n    ${z(A)}\n    ${z(N)}\n    ${z(j)}\n    ${n}\n    </form>\n    ${function(e,t){return`<div class="${f} ${h} ${w}">\n      <p class="${b}">${e.title}</p>\n      <label class="${L}">\n        <input type="checkbox" \n                id="${e.id}" \n                class="${S}"\n                name="${e.name}" \n                value="${"banner"===t.mode?e.checkedValue:e.uncheckedValue}"\n                data-checked-value="${e.checkedValue}"\n                data-unchecked-value="${e.uncheckedValue}"\n                ${"banner"===t.mode?"checked":""}>\n        <span class="${D}"></span>\n      </label>\n  </div>`}(X,e)}\n    </div>`};let R,H;function Y(e){R=e.offsetX,H=e.offsetY,e.dataTransfer.setData("text/plain",e.target.id)}function G(e){e.preventDefault()}function Q(e){try{const t=JSON.parse(sessionStorage.getItem(e));Object.keys(B).forEach((e=>{const n=B[e];!function(e,t){const n=[...document.querySelector(`.${g}`).querySelectorAll(e)].find((e=>e.id===t));if(!n)return;n.setAttribute("checked","");const{value:o}=n,a=n.closest(`.${f}`).querySelector(`.${k}`);a&&(a.innerHTML=o)}(`#${n.id} input`,`${n.valuePrefix}-${t[e]}`)})),Object.keys(K).forEach((t=>{!function(e,t,n){try{const o=JSON.parse(sessionStorage.getItem(n)),a=document.querySelector(`.${g}`).querySelector(`#${e}`);if("false"===o[t])return;a.setAttribute("checked","checked")}catch(e){console.log("Unable to parse modal settings",e)}}(K[t].id,t,e)}))}catch(e){console.log("Unable to parse modal settings",e)}}function W(e){e.stopPropagation(),e.preventDefault();!function(e){"checked"===e.getAttribute("checked")?e.removeAttribute("checked","false"):e.setAttribute("checked","checked")}(e.target.parentElement.querySelector("input"))}function Z(e){const t=[...e],n=[...Object.keys(B),...Object.keys(K)],o=function(e){const t=window.location.search;if(!t)return;return t.replace("?","").split("&").map((e=>e.split("="))).filter((t=>!e.includes(t[0])))}(n)||[],a=n.map((e=>t.find((t=>t[0]===e))||[e,K[e].uncheckedValue]));return[...o,...a].map((e=>`${e[0]}=${e[1]}`)).join("&")}function ee(e){e.preventDefault();!function(e){const t=`${window.location.href.split("?")[0]}?${e}`;window.location.href=t}(Z(new FormData(document.getElementById(U.settingsModalFormId))))}function te(e,t,n){const a=e.querySelector(`.${x}`),s=e.querySelector(`.${T}`),l=e.querySelector(`.${w} .${L}`);a.addEventListener("click",(()=>function(e,t,n){e.classList.remove(`${r}`),e.classList.add(`${i}`);const a={...t};a.mode="open",o(a,n)}(e,t,n))),s.addEventListener("click",(()=>function(e,t,n){e.classList.remove(`${i}`),e.classList.add(`${r}`);const a={...t};a.mode="closed",o(a,n)}(e,t,n))),l.addEventListener("click",(a=>function(e,t,n,a){if(e.stopPropagation(),e.preventDefault(),"checked"===e.target.parentElement.querySelector("input").getAttribute("checked")){t.classList.add(`${d}`);const e={...n};return e.mode="banner",void o(e,a)}t.classList.remove(`${d}`);const s={...n};s.mode="open",o(s,a)}(a,e,t,n)))}function ne(e,t,n){e.addEventListener("dragstart",Y,0),document.body.addEventListener("dragover",G,0),document.body.addEventListener("drop",(e=>function(e,t,n){e.preventDefault(),e.stopPropagation();const a=e.dataTransfer.getData("text"),s=document.getElementById(a),l=e.pageX-R,c=e.pageY-H;var i,r,d;r=l,d=c,(i=s).style.top=`${d}px`,i.style.left=`${r}px`;const u={...t};u.posTop=c,u.posLeft=l,o(u,n),e.dataTransfer.clearData()}(e,t,n)),0)}const oe=e=>{const{defaultDevSettings:t,sessionStorageKey:n,sessionStorageDevKey:o}=e;Q(n),function(){const e=document.querySelectorAll(`.${L}`),t=document.getElementById(U.settingsModalSubmitId);e.forEach((e=>{e.addEventListener("click",W)})),t.addEventListener("click",ee)}();const a=document.querySelector(`.${c}`);te(a,t,o),t.isDraggable&&ne(a,t,o)},ae={settings:{lowRAM:4,lowCPU:4,slowConnectionTypes:["slow-2g","2g","3g"]},sessionStorageKey:"progressiveUserSettings",sessionStorageDevKey:"progressiveUserDevSettings",defaultDevSettings:{isDraggable:1,mode:"closed",posTop:20,posLeft:20}},se=o=>{const l={...ae,...o},{sessionStorageKey:c,sessionStorageDevKey:i,defaultDevSettings:r}=l,d=(()=>{const e=new URLSearchParams(window.location.search).entries(),t={};return[...e].forEach((e=>{const[n,o]=e;t[n]=o})),t})(),u=n(c),p=n(i),g=t(c)?(t=>{const{slowConnectionTypes:n}=t;return{connectionSpeed:e(n)}})(l.settings):s(l.settings),v=Object.assign(u,g,d);a(v,c),window.addEventListener("load",(()=>{const e=Object.keys(p).length?p:r;document.body.insertAdjacentHTML("afterbegin",J(e)),oe(l)}))};window.progUXdev=se}();
